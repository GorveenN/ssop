{% extends 'base.html' %}

{% block title %}{{ subject.name }}{% endblock %}

{% block content %}
    <h1>{{subject.name}}</h1>

    {% block info %}

        <div class="flex-container">
            <div>
                <h5 class="font-italic">USOSWeb: <a href="{{ subject.usos_link|default_if_none:'' }}">link</a></h5>
            </div>
        </div>

        <h3>Wszystkie komentarze:</h3>
    {% endblock %}

    <!--TODO: add comments display and form for adding comments and all that remaining stuff from trello -->
    <!--TODO: cookies?? (do they work as we wish?) -->
    {% for comment in comments %}
        
    {% empty %}
        <div class="well well-sm">
            <p>Nie ma tu jeszcze żadnego komentarza. Może czas to zmienić? :)</p>
        </div>
    {% endfor %}
    
    {% if subject != 'Wszystkie komentarze' %}
        <h4>Wypelnij ankiete:</h4>
        <form class="add_comment_form"
              action="{% url 'add_subject_survey' %}?redirect={{ request.get_full_path | urlencode }}"
              method="post">
            {% csrf_token %}
            {{ managment_form }}
            <input type="hidden" value="{{ subject.usos_id }}" name="subject_id">

            <div id="pytaniaAnkiet" class="list-group">
                {% for que, form in survey %}
                    <div class="list-group-item">
                        <span>{{ que }}</span>
                        <span class="starrating">
                    <input type="hidden" name="form-{{ forloop.counter0 }}-question" value="{{ que.pk }}">

                            {% for field in form %}
                                {% for item in field %}
                                    <input type="radio" id="{{ item.id_for_label }}"
                                           name="{{ field.html_name }}"
                                           value="{{ item.data.value }}"
                                           required/>
                                    <label for="{{ item.id_for_label }}"></label>
                                {% endfor %}
                            {% endfor %}
                        </span>
                    </div>
                {% endfor %}
            </div>
            {% with subject_id=subject.usos_id|stringformat:"i" %}
            {% with cookie_string="ts-"|add:subject_id %}
                {% if cookie_string|add:"-chg" in request.COOKIES %}
                    <button class="btn btn-outline-info" type="submit">Zmień odpowiedź</button>
                {% elif cookie_string|add:"-dsb" in request.COOKIES %}
                    <button class="btn btn-outline-info" type="submit" disabled>Głos oddany</button>
                {% else %}
                    <button class="btn btn-outline-info" type="submit">Zagłosuj</button>
                {% endif %}
            {% endwith %}
            {% endwith %}
        </form>

        <h4>Dodaj komentarz:</h4>
    {% endif %}
</div>

{% endblock %}
